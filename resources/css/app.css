@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
    .card {
        @apply bg-white dark:bg-gray-800 shadow-sm rounded-xl border border-gray-100 dark:border-gray-700;
    }

    /* =========================================
       NATIVE SCANNER TRANSPARENCY (Hole Punch)
       ========================================= */
       
    body.is-native-scanning {
        background-color: transparent !important;
    }

    /* 1. Global Transparency */
    body.is-native-scanning #scan-wrapper, 
    body.is-native-scanning .min-h-screen,
    body.is-native-scanning main, 
    body.is-native-scanning #app {
        background-color: transparent !important;
        background-image: none !important;
    }

    /* 2. THE CARD (Container) */
    /* This must be transparent to let the camera through, BUT we need to ensure it blocks the camera 
       for the header/footer parts. We DO NOT use box-shadow here to avoid layout shifts. */
    body.is-native-scanning #scanner-card {
        background-color: transparent !important;
        border-color: transparent !important;
        /* No overflow hidden here, or we clip the large shadow from the child */
        overflow: visible !important; 
        box-shadow: none !important;
    }
    
    /* 3. THE HOLE (The actual window) */
    body.is-native-scanning #scanner {
        background-color: transparent !important;
        border-color: transparent !important;
        position: relative;
        z-index: 0;
        /* This GIANT shadow covers the entire screen EXCEPT the hole */
        box-shadow: 0 0 0 9999px #fff !important; 
    }

    .dark body.is-native-scanning #scanner {
        box-shadow: 0 0 0 9999px #1f2937 !important; /* dark: gray-800 */
    }

    /* 4. Hide Web Video (Only on Native) */
    body.is-native-scanning #scanner video {
        display: none !important; 
    }
    
    /* 5. Force Web Video Object Fit */
    #scanner video {
        width: 100% !important;
        height: 100% !important;
        object-fit: cover !important;
        border-radius: 1rem;
    }

    /* 6. HEADER VISIBILITY FIX */
    /* All card content (headers, buttons) MUST sit on top of the giant shadow */
    body.is-native-scanning #scanner-card h3, 
    body.is-native-scanning #scanner-card button,
    body.is-native-scanning #scanner-card .header-actions,
    body.is-native-scanning #scanner-placeholders, 
    body.is-native-scanning #scanner-overlay,
    body.is-native-scanning #scanner-result,
    body.is-native-scanning #scanner-error {
        position: relative;
        z-index: 60 !important; /* Higher than mask */
    }

    /* 7. GLOBAL APP HEADER FIX */
    /* Fix: Use 'fixed' to prevent it from dropping into the padded main content area */
    body.is-native-scanning nav, 
    body.is-native-scanning header {
        position: fixed !important; /* Keep it pinned to top */
        top: 0;
        left: 0;
        right: 0;
        width: 100%;
        z-index: 70 !important;
        background-color: #fff !important; 
        
        /* Respect Safe Area (Status Bar) - Standard, no extra fallback */
        padding-top: env(safe-area-inset-top) !important;
        box-sizing: content-box !important; /* Ensure padding adds to height if needed, OR border-box if we want fixed h-16 */
    }
    
    /* Ensure content is not hidden behind the fixed header */
    body.is-native-scanning main {
        /* Base 4rem (nav height) + Safe Area Padding */
        padding-top: calc(4rem + env(safe-area-inset-top)) !important;
    }

    /* Remove extra padding from the page wrapper to reduce gap */
    body.is-native-scanning main > div {
        padding-top: 0 !important; 
        margin-top: -2.5rem !important; /* Aggressively pull up closer to nav */
    }
    
    .dark body.is-native-scanning nav, 
    .dark body.is-native-scanning header {
        background-color: #1f2937 !important;
    }
    
    /* 8. WEB SCANNER ASPECT RATIO FIX */
    /* Ensure strict square shape for Web Scanner */
    .scanner-container {
        aspect-ratio: 1 / 1 !important;
        max-height: 80vh; /* Prevent overflow on small screens */
        width: 100% !important;
        overflow: hidden !important;
    }
}

@layer utilities {
    .pulse-dot {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }
    @keyframes scaleIn {
        0% { transform: scale(0); opacity: 0; }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); opacity: 1; }
    }
    @keyframes slideDown {
        0% { transform: translateY(-20px); opacity: 0; }
        100% { transform: translateY(0); opacity: 1; }
    }
    /* Provide utility classes if not using arbitrary values */
    .animate-scale-in { animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
    .animate-slide-down { animation: slideDown 0.6s cubic-bezier(0.4, 0, 0.2, 1); }

    /* Mosallas-Group Pull To Refresh Port */
    .refresh-container {
        width: 50px;
        height: 50px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 100%;
        transition: margin-top 0.2s; /* Faster for native feel */
        margin-top: -50px; /* Hide initially */
        position: fixed; /* Fixed to viewport to avoid static flow issues */
        top: 0; 
        left: 0; right: 0;
        z-index: 9999; /* Ensure high z-index above header */
        pointer-events: none; /* Don't block clicks when hidden */
    }
    
    .refresh-container.load-init,
    .refresh-container.load-start {
        pointer-events: auto; /* Allow interaction if needed, or keep none */
    }

    .refresh-container .spinner {
        width: 30px;
        height: 30px;
        z-index: 52; /* Above ripple */
        transition: transform 0.2s;
        color: #0430e2; /* Initial color */
    }

    .refresh-container.load-init .spinner * {
        color: #ffffff; /* White on blue bg */
    }

    .refresh-container.load-init::after {
        content: "";
        background-color: #0430e2;
        width: 50px;
        height: 50px;
        border-radius: 100%;
        position: absolute;
        z-index: 51;
        transition: 0.5s; /* Smooth fill */
    }

    .refresh-container.load-start .spinner {
        animation: spin 0.5s linear infinite;
    }

    .refresh-container.load-start .spinner * {
        color: #000000; /* Black on expanded? Or stick to white if blue expands? */
        /* Mosallas original turns black on load start? Let's verify visual intent */
    }

    .refresh-container.load-start::after {
        content: "";
        background-color: #3b82f6; /* Tailwind Blue 500 */
        transform: scale(20); /* Expand to fill screen */
        opacity: 0.1; /* Make it subtle overlay instead of full block */
        z-index: 49;
        transition: transform 0.5s ease-out, opacity 0.5s;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(359deg); }
    }

    /* Indeterminate Progress Bar */
    .animate-progress-indeterminate {
        animation: progress-indeterminate 1.5s infinite linear;
        transform-origin: 0% 50%;
    }

    @keyframes progress-indeterminate {
        0% { transform: translateX(0) scaleX(0); }
        40% { transform: translateX(0) scaleX(0.4); }
        100% { transform: translateX(100%) scaleX(0.5); }
    }
}

